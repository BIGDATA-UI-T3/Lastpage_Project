<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>추모 굿즈 간편예약</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- CSS: 공통 먼저, 페이지 전용 나중 -->
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/Goods_reserve.css}">
</head>
<body>

<!-- 헤더(메인과 동일) -->
<div class="header-wrapper">
    <header>
        <div class="logo">
            <a href="#"><img th:src="@{/asset/LastPage로고_투명.png}" alt="로고" /></a>
        </div>
        <nav>
            <ul>
                <li>
                    <a href="#">홈</a>
                    <ul><li><a href="#">인사말</a></li></ul>
                </li>
                <li><a href="#">장례서비스</a></li>
                <li><a href="#">Ourpage</a></li>
                <li>
                    <a href="#">심리상담</a>
                    <ul>
                        <li><a href="#">상담예약</a></li>
                        <li><a href="#">예약조회</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#">추모굿즈</a>
                    <ul>
                        <li><a href="#">굿즈소개</a></li>
                        <li><a href="#">굿즈예약</a></li>
                        <li><a href="#">예약조회</a></li>
                    </ul>
                </li>
                <li><a href="#">마이페이지</a></li>
                <li><a href="#">고객센터</a></li>
            </ul>
        </nav>
        <div class="auth">
            <a href="#">로그인</a>
            <a href="#">회원가입</a>
        </div>
    </header>

    <!-- 배너 -->
    <section class="banner" role="img" aria-label="추모 굿즈 간편예약 배너">
        <div class="inner">
            <h1>사랑을 형태로 남기는 맞춤 제작</h1>
            <p>유골·모발·발자국 등 소중한 흔적으로 주얼리/액자/레진 오브제를 제작합니다.</p>
        </div>
    </section>
</div>

<!-- 본문: 추모 굿즈 간편예약 폼 -->
<main>
    <div class="wrap">
        <div class="card">
            <div class="steps" aria-label="예약 단계">
                <div class="step-dot active" id="dot1"></div>
                <div class="step-dot" id="dot2"></div>
                <div class="step-dot" id="dot3"></div>
                <div class="step-dot" id="dot4"></div>
            </div>

            <h1 class="title">추모 굿즈 간편예약</h1>

            <!-- STEP 1 : 신청자/반려동물 & 보관 중인 흔적 -->
            <section class="step active" id="step1">
                <div class="grid">
                    <div>
                        <label class="small">신청자명</label>
                        <div class="field"><input id="ownerName" type="text" placeholder="홍길동" required></div>
                    </div>
                    <div>
                        <label class="small">휴대폰번호</label>
                        <div class="field"><input id="ownerPhone" type="tel" inputmode="numeric" placeholder="01012345678" required></div>
                    </div>
                    <div>
                        <label class="small">이메일</label>
                        <div class="field"><input id="ownerEmail" type="email" placeholder="name@example.com" required></div>
                    </div>
                    <div>
                        <label class="small">수령/반송 주소</label>
                        <div class="field"><input id="ownerAddr" type="text" placeholder="시/구/동, 상세 주소" required></div>
                    </div>

                    <div>
                        <label class="small">반려동물 이름</label>
                        <div class="field"><input id="petName" type="text" placeholder="모모" required></div>
                    </div>
                    <div>
                        <label class="small">반려동물 종류</label>
                        <div class="field">
                            <select id="petType" required>
                                <option value="">선택</option>
                                <option value="dog">개</option>
                                <option value="cat">고양이</option>
                                <option value="small">소동물</option>
                                <option value="other">기타</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="small">품종</label>
                        <div class="field">
                            <select id="petBreed" required disabled>
                                <option value="">종류 선택 먼저</option>
                            </select>
                            <input id="petBreedText" type="text" placeholder="직접 입력" style="display:none;">
                        </div>
                        <small class="muted">※ “기타” 선택 시 품종을 직접 입력하세요.</small>
                    </div>
                    <div>
                        <label class="small">체중(kg)</label>
                        <div class="field"><input id="petWeight" type="number" min="0" step="0.1" placeholder="4.2" required></div>
                    </div>
                </div>

                <div class="grid-1" style="margin-top:8px">
                    <label class="small">보유 중인 흔적(최소 1개)</label>
                    <div class="slots" id="materialsBox" role="group" aria-label="보유 흔적">
                        <button type="button" class="slot" data-mat="ash">유골</button>
                        <button type="button" class="slot" data-mat="hair">모발</button>
                        <button type="button" class="slot" data-mat="paw">발자국(클레이/잉크)</button>
                        <button type="button" class="slot" data-mat="item">유품(리본/털뭉치 등)</button>
                    </div>
                    <small class="muted">※ 보관은 건조·밀봉 상태 권장. 분량 안내는 다음 단계에서 확인합니다.</small>
                </div>

                <div class="actions">
                    <button class="btn secondary" type="button" disabled>이전</button>
                    <button id="next1" class="btn primary" type="button" disabled>다음</button>
                </div>
            </section>

            <!-- STEP 2 : 품목/옵션 선택 -->
            <section class="step" id="step2">
                <div class="grid">
                    <div>
                        <label class="small">품목</label>
                        <div class="field">
                            <select id="product" required>
                                <option value="">선택</option>
                                <option value="necklace">주얼리 - 목걸이(봉입)</option>
                                <option value="ring">주얼리 - 반지(봉입)</option>
                                <option value="keyring">키링/참(봉입)</option>
                                <option value="resin">레진 오브제</option>
                                <option value="frame">포토/발자국 액자</option>
                                <option value="candle">메모리 캔들</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="small">메탈/색상(해당 시)</label>
                        <div class="field">
                            <select id="metal">
                                <option value="">선택(해당 시)</option>
                                <option>실버</option>
                                <option>스테인리스</option>
                                <option>골드톤</option>
                                <option>로즈골드톤</option>
                            </select>
                        </div>
                        <small class="muted">※ 레진/액자/캔들은 선택하지 않아도 됩니다.</small>
                    </div>

                    <div id="chainRow" style="display:none">
                        <label class="small">체인 길이</label>
                        <div class="field">
                            <select id="chainLength">
                                <option value="">선택</option>
                                <option>40cm</option><option>45cm</option><option>50cm</option>
                            </select>
                        </div>
                    </div>

                    <div id="ringRow" style="display:none">
                        <label class="small">반지 호수</label>
                        <div class="field"><input id="ringSize" type="text" placeholder="예: 12호"></div>
                    </div>

                    <div>
                        <label class="small">수량</label>
                        <div class="field"><input id="qty" type="number" min="1" step="1" value="1"></div>
                    </div>
                </div>

                <div class="grid-1" style="margin-top:10px">
                    <div>
                        <label class="small">각인(선택)</label>
                        <div class="field"><input id="engrave" type="text" maxlength="20" placeholder="예: MOMO 2025.08.27 (20자 이내)"></div>
                    </div>
                    <div>
                        <label class="small">각인 폰트</label>
                        <div class="field">
                            <select id="font">
                                <option value="">선택(선택 시)</option>
                                <option>Classic</option><option>Sans</option><option>Script</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="small">기타 옵션/설명(선택)</label>
                        <div class="field" style="align-items:start">
                            <textarea id="optMemo" rows="3" maxlength="300" placeholder="예: 유골·모발 비율, 레진 색상 톤 등"></textarea>
                        </div>
                        <div class="count"><span id="optCount">0</span>/300</div>
                    </div>
                </div>

                <div class="actions">
                    <button class="btn secondary" type="button" id="prev2">이전</button>
                    <button id="next2" class="btn primary" type="button" disabled>다음</button>
                </div>
            </section>

            <!-- STEP 3 : 수거/배송 & 완료 희망일 -->
            <section class="step" id="step3">
                <div class="grid">
                    <div>
                        <label class="small">재료 전달 방식</label>
                        <div class="field">
                            <select id="shipMethod" required>
                                <option value="">선택</option>
                                <option value="kit">수거키트 신청(택배 수거)</option>
                                <option value="visit">직접 방문</option>
                                <option value="post">자가 발송(우편/택배)</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="small">완성 희망일</label>
                        <div class="field"><input id="targetDate" type="date" required></div>
                        <small class="note">일반 제작은 최소 +7일 이후 날짜를 권장합니다.</small>
                    </div>

                    <div>
                        <label class="small">익스프레스(선택)</label>
                        <div class="field" style="gap:10px">
                            <input id="express" type="checkbox">
                            <span class="muted">빠른 제작 요청(가능 일정 확인 후 안내)</span>
                        </div>
                    </div>
                </div>

                <!-- 방식별 추가 입력 -->
                <div class="grid" id="kitBox" style="display:none; margin-top:4px">
                    <div>
                        <label class="small">수거 주소</label>
                        <div class="field"><input id="kitAddr" type="text" placeholder="도로명, 건물명 등 상세 주소"></div>
                    </div>
                    <div>
                        <label class="small">수거 희망일</label>
                        <div class="field"><input id="kitDate" type="date"></div>
                    </div>
                    <div style="grid-column:1/-1">
                        <label class="small">수거 시간대</label>
                        <div class="seg">
                            <button class="seg-btn is-active" type="button" data-seg="am">오전</button>
                            <button class="seg-btn" type="button" data-seg="pm">오후</button>
                        </div>
                        <div id="timeSlots" class="slots" role="listbox" aria-label="수거 시간 선택"></div>
                    </div>
                </div>

                <div class="grid" id="visitBox" style="display:none; margin-top:4px">
                    <div>
                        <label class="small">방문 희망일</label>
                        <div class="field"><input id="visitDate" type="date"></div>
                    </div>
                    <div>
                        <label class="small">방문 시간</label>
                        <div class="field"><input id="visitTime" type="time"></div>
                    </div>
                </div>

                <div class="grid" id="postBox" style="display:none; margin-top:4px">
                    <div style="grid-column:1/-1">
                        <label class="small">발송 예정 택배사/운송장(선택)</label>
                        <div class="field"><input id="tracking" type="text" placeholder="예: OO택배 1234-5678-9012"></div>
                    </div>
                </div>

                <div class="grid-1" style="margin-top:10px">
                    <div>
                        <label class="small">요청사항(선택)</label>
                        <div class="field" style="align-items:start">
                            <textarea id="memo" rows="4" maxlength="300" placeholder="제작 시 유의점, 비율, 포장 등"></textarea>
                        </div>
                        <div class="count"><span id="memoCount">0</span>/300</div>
                    </div>
                    <label class="field" style="gap:10px">
                        <input type="checkbox" id="consent" />
                        <span>제작 과정상 색·입자·기포 등 미세 차이가 발생할 수 있음을 이해하며, 남은 흔적의 보관/반송에 동의합니다.</span>
                    </label>
                </div>

                <div class="actions">
                    <button class="btn secondary" type="button" id="prev3">이전</button>
                    <button id="next3" class="btn primary" type="button" disabled>다음</button>
                </div>
            </section>

            <!-- STEP 4 : 확인/완료 -->
            <section class="step" id="step4">
                <div class="grid-1">
                    <div class="field" style="justify-content:center">
                        <strong>입력한 예약 내용을 확인해 주세요.</strong>
                    </div>
                    <div class="summary" id="summary"></div>
                    <label class="field" style="gap:10px">
                        <input type="checkbox" id="confirmChk" />
                        <span>입력한 내용이 정확합니다.</span>
                    </label>
                </div>

                <div class="actions">
                    <button class="btn secondary" type="button" id="prev4">이전</button>
                    <button class="btn primary" type="button" id="submitBtn" disabled>제출하기</button>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- 푸터(메인과 동일) -->
<footer>
    대충 연락처 / GitHub 주소 / 이메일 등 입력 예정/ 푸터 높이는 헤더 배너 반응 테스트용.
</footer>

<!-- 공통 스크립트: 헤더 숨김 -->
<script>
    (function () {
      const header = document.querySelector('header');
      window.addEventListener('scroll', () => {
        header.style.top = (window.scrollY > 200) ? '-120px' : '0';
      });
    })();
</script>

<!-- 예약 폼 스크립트 -->
<script>
    const $  = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    // 🎯 [수정] DTO 필드명과 일치시켰습니다.
    const ST = {
      // step1
      ownerName:"", ownerPhone:"", ownerEmail:"", ownerAddr:"",
      petName:"", petType:"", petBreed:"", petWeight:"",
      materials: [],

      // step2
      product:"", metalColor:"", chainLength:"", ringSize:"", quantity:1,
      engravingText:"", engravingFont:"", optionsMemo:"",

      // step3
      shipMethod:"", targetDate:"", isExpress:false,
      kitAddr:"", kitDate:"", kitTime:"", // 수거 시간(슬롯)
      visitDate:"", visitTime:"", trackingInfo:"",
      memo:""
    };

    // 품종 데이터
    const BREEDS = {
      dog: ["말티즈","푸들","시바","리트리버","포메라니안","믹스"],
      cat: ["코리안숏헤어","페르시안","러시안블루","먼치킨","랙돌","믹스"],
      small: ["햄스터","토끼","기니피그","패럿","앵무새"]
    };

    // 날짜 제한
    (function setLimits(){
      const t=new Date();
      const y=t.getFullYear(), m=String(t.getMonth()+1).padStart(2,'0'), d=String(t.getDate()).padStart(2,'0');
      const today = `${y}-${m}-${d}`;
      const minTarget = new Date(t); minTarget.setDate(minTarget.getDate()+7);
      const y2=minTarget.getFullYear(), m2=String(minTarget.getMonth()+1).padStart(2,'0'), d2=String(minTarget.getDate()).padStart(2,'0');

      $('#targetDate').min = `${y2}-${m2}-${d2}`;
      $('#kitDate').min = today;
      $('#visitDate').min = today;
    })();

    // STEP 이동
    function gotoStep(n){
      $$('.step').forEach((el,i)=> el.classList.toggle('active', i===n-1));
      $$('.step-dot').forEach((d,i)=> d.classList.toggle('active', i<=n-1));
      window.scrollTo({top:0, behavior:'smooth'});
      if(n===4) renderSummary();
    }

    // 종류/품종 처리
    const petTypeEl = $('#petType');
    const petBreedSel = $('#petBreed');
    const petBreedText = $('#petBreedText');

    petTypeEl.addEventListener('change', () => {
      const type = petTypeEl.value;
      ST.petType = type;
      if(!type){
        petBreedSel.innerHTML = '<option value="">종류 선택 먼저</option>';
        petBreedSel.disabled = true;
        petBreedText.style.display='none';
        petBreedText.value='';
        v1(); return;
      }
      if(type === 'other'){
        petBreedSel.disabled = true;
        petBreedSel.innerHTML = '<option value="">직접 입력</option>';
        petBreedText.style.display='block';
        ST.petBreed = petBreedText.value.trim();
      }else{
        petBreedSel.disabled = false;
        petBreedText.style.display='none';
        petBreedText.value='';
        petBreedSel.innerHTML = '<option value="">품종 선택</option>' + (BREEDS[type]||[]).map(b=>`<option>${b}</option>`).join('');
        ST.petBreed = '';
      }
      v1();
    });

    petBreedSel.addEventListener('change', () => { ST.petBreed = petBreedSel.value; v1(); });
    petBreedText.addEventListener('input', () => { ST.petBreed = petBreedText.value.trim(); v1(); });

    // 보유 흔적 토글
    $$('#materialsBox .slot').forEach(b=>{
      b.addEventListener('click', ()=>{
        const v=b.dataset.mat;
        if(b.classList.toggle('active')){
          if(!ST.materials.includes(v)) ST.materials.push(v);
        }else{
          ST.materials = ST.materials.filter(x=>x!==v);
        }
        v1();
      });
    });

    // STEP1 검증 (이 로직은 원래 문제가 없었습니다)
    function v1(){
      const name = $('#ownerName').value.trim();
      const phone = $('#ownerPhone').value.replace(/\D/g,'');
      const email = $('#ownerEmail').value.trim();
      const addr  = $('#ownerAddr').value.trim();
      const pnm   = $('#petName').value.trim();
      const pwt   = $('#petWeight').value.trim();

      ST.ownerName=name; ST.ownerPhone=phone; ST.ownerEmail=email; ST.ownerAddr=addr;
      ST.petName=pnm; ST.petWeight=pwt;

      const emailOK = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      const breedOK = (ST.petType==='other') ? !!ST.petBreed : (!!ST.petType && !!ST.petBreed);
      const matOK   = ST.materials.length > 0;

      const ok = name && phone.length>=10 && emailOK && addr && pnm && breedOK && Number(pwt)>=0 && matOK;
      $('#next1').disabled = !ok;
    }
    $$('#step1 input, #step1 select').forEach(el=> el.addEventListener('input', v1));
    v1();
    $('#next1').addEventListener('click', ()=> gotoStep(2));

    // STEP2: 품목에 따른 옵션 표시
    const productEl = $('#product');
    const chainRow = $('#chainRow');
    const ringRow  = $('#ringRow');

    productEl.addEventListener('change', ()=>{
      ST.product = productEl.value;
      chainRow.style.display = (ST.product==='necklace') ? '' : 'none';
      ringRow.style.display  = (ST.product==='ring') ? '' : 'none';
      v2();
    });

    // 🎯 [수정] DTO 필드명과 일치시켰습니다.
    $('#metal').addEventListener('change', e=>{ ST.metalColor=e.target.value; v2(); });
    $('#chainLength').addEventListener('change', e=>{ ST.chainLength=e.target.value; v2(); });
    $('#ringSize').addEventListener('input', e=>{ ST.ringSize=e.target.value.trim(); v2(); });
    $('#qty').addEventListener('input', e=>{ ST.quantity = Math.max(1, parseInt(e.target.value||'1',10)); v2(); });
    $('#engrave').addEventListener('input', e=>{ ST.engravingText=e.target.value; v2(); });
    $('#font').addEventListener('change', e=>{ ST.engravingFont=e.target.value; v2(); });
    $('#optMemo').addEventListener('input', e=>{ ST.optionsMemo=e.target.value; $('#optCount').textContent = e.target.value.length; });

    function v2(){
      // 🎯 [수정] ST.quantity로 검사
      let ok = !!ST.product && (+ST.quantity>=1);

      // 세부 옵션 필수 조건
      if(ST.product==='necklace'){ ok = ok && !!ST.chainLength; }
      if(ST.product==='ring'){ ok = ok && !!ST.ringSize; }

      $('#next2').disabled = !ok;
    }
    $('#prev2').addEventListener('click', ()=> gotoStep(1));
    $('#next2').addEventListener('click', ()=> gotoStep(3));

    // STEP3: 수거/배송/날짜
    const AM = ["09:00","09:30","10:00","10:30","11:00","11:30"];
    const PM = ["13:00","13:30","14:00","14:30","15:00","15:30","16:00"];
    let currentSeg='am', selectedBtn=null;

    function buildSlots(){
      const list = currentSeg==='am' ? AM : PM;
      const box = $('#timeSlots'); box.innerHTML='';

      // 🎯 [수정] DTO 필드명과 일치
      selectedBtn=null; ST.kitTime='';
      list.forEach(t=>{
        const b=document.createElement('button');
        b.type='button'; b.className='slot'; b.textContent=t; b.dataset.value=t;
        b.addEventListener('click', ()=>{
          selectedBtn?.classList.remove('active');
          b.classList.add('active'); selectedBtn=b;
          // 🎯 [수정] DTO 필드명과 일치
          ST.kitTime=t; v3();
        });
        box.appendChild(b);
      });
    }
    buildSlots();
    $$('.seg-btn').forEach(b=>{
      b.addEventListener('click', ()=>{
        $('.seg-btn.is-active')?.classList.remove('is-active');
        b.classList.add('is-active');
        currentSeg=b.dataset.seg; buildSlots();
      });
    });

    // 방식 스위치
    $('#shipMethod').addEventListener('change', e=>{
      ST.shipMethod = e.target.value;
      $('#kitBox').style.display   = ST.shipMethod==='kit' ? 'grid':'none';
      $('#visitBox').style.display = ST.shipMethod==='visit' ? 'grid':'none';
      $('#postBox').style.display  = ST.shipMethod==='post' ? 'grid':'none';
      v3();
    });

    // 타깃 날짜/익스프레스
    $('#targetDate').addEventListener('change', e=>{ ST.targetDate=e.target.value; v3(); });
    $('#express').addEventListener('change', e=>{
      // 🎯 [수정] DTO 필드명과 일치
      ST.isExpress=e.target.checked;

      // 🎯 [수정] DTO 필드명과 일치
      const t=new Date(), add=ST.isExpress?3:7; t.setDate(t.getDate()+add);
      const y=t.getFullYear(), m=String(t.getMonth()+1).padStart(2,'0'), d=String(t.getDate()).padStart(2,'0');
      $('#targetDate').min = `${y}-${m}-${d}`;
      if(ST.targetDate && ST.targetDate < $('#targetDate').min){ ST.targetDate=''; $('#targetDate').value=''; }
      v3();
    });

    // 방식별 필드
    $('#kitAddr').addEventListener('input', e=>{ ST.kitAddr=e.target.value.trim(); v3(); });
    $('#kitDate').addEventListener('change', e=>{ ST.kitDate=e.target.value; v3(); });

    $('#visitDate').addEventListener('change', e=>{ ST.visitDate=e.target.value; v3(); });
    $('#visitTime').addEventListener('change', e=>{ ST.visitTime=e.target.value; v3(); });

    // 🎯 [수정] DTO 필드명과 일치
    $('#tracking').addEventListener('input', e=>{ ST.trackingInfo=e.target.value.trim(); });

    $('#memo').addEventListener('input', e=>{ ST.memo=e.target.value; $('#memoCount').textContent = e.target.value.length; });

    $('#consent').addEventListener('change', v3);

    function v3(){
      let ok = !!ST.shipMethod && !!ST.targetDate && $('#consent').checked;

      if(ST.shipMethod==='kit'){
        // 🎯 [수정] DTO 필드명과 일치
        ok = ok && !!ST.kitAddr && !!ST.kitDate && !!ST.kitTime;
      }
      if(ST.shipMethod==='visit'){
        ok = ok && !!ST.visitDate && !!ST.visitTime;
      }
      $('#next3').disabled = !ok;
    }

    $('#prev3').addEventListener('click', ()=> gotoStep(2));
    $('#next3').addEventListener('click', ()=> gotoStep(4));

    // 요약 & 제출
    function renderSummary(){
      const matMap = {ash:'유골', hair:'모발', paw:'발자국', item:'유품'};
      const mats = ST.materials.map(m=>matMap[m]||m).join(', ');

      // 🎯 [수정] DTO 필드명과 모두 일치시켰습니다.
      const lines = [
        `<div><strong>신청자</strong> : ${ST.ownerName} / ${ST.ownerPhone} / ${ST.ownerEmail}</div>`,
        `<div><strong>수령/반송 주소</strong> : ${ST.ownerAddr}</div>`,
        `<div><strong>반려동물</strong> : ${ST.petName} (${ST.petType||'-'} / ${ST.petBreed||'-'}, ${ST.petWeight}kg)</div>`,
        `<div><strong>보유 흔적</strong> : ${mats||'-'}</div>`,
        `<hr style="border:none;border-top:1px solid #eee;margin:10px 0">`,
        `<div><strong>품목</strong> : ${ST.product}</div>`,
        `<div><strong>메탈/색상</strong> : ${ST.metalColor||'-'}</div>`,
        (ST.product==='necklace') ? `<div><strong>체인 길이</strong> : ${ST.chainLength}</div>` : '',
        (ST.product==='ring')     ? `<div><strong>반지 호수</strong> : ${ST.ringSize}</div>`   : '',
        `<div><strong>수량</strong> : ${ST.quantity}</div>`,
        `<div><strong>각인</strong> : ${ST.engravingText||'-'} ${ST.engravingFont?`(폰트: ${ST.engravingFont})`:''}</div>`,
        ST.optionsMemo ? `<div><strong>옵션 설명</strong> : ${ST.optionsMemo.replace(/\n/g,'<br>')}</div>` : '',
        `<hr style="border:none;border-top:1px solid #eee;margin:10px 0">`,
        `<div><strong>재료 전달</strong> : ${ST.shipMethod}</div>`,
        (ST.shipMethod==='kit')   ? `<div><strong>수거</strong> : ${ST.kitAddr} / ${ST.kitDate} ${ST.kitTime||''}</div>` : '',
        (ST.shipMethod==='visit') ? `<div><strong>방문</strong> : ${ST.visitDate} ${ST.visitTime}</div>` : '',
        (ST.shipMethod==='post')  ? `<div><strong>자가 발송</strong> : ${ST.trackingInfo||'-'}</div>` : '',
        `<div><strong>완성 희망일</strong> : ${ST.targetDate} ${ST.isExpress?'(익스프레스 요청)':''}</div>`,
        ST.memo ? `<div><strong>요청사항</strong> : ${ST.memo.replace(/\n/g,'<br>')}</div>` : ''
      ].filter(Boolean).join('');

      $('#summary').innerHTML = lines;
    }

    $('#confirmChk').addEventListener('change', ()=> $('#submitBtn').disabled = !$('#confirmChk').checked);
    $('#prev4').addEventListener('click', ()=> gotoStep(3));

    $('#submitBtn').addEventListener('click', ()=>{

      // fetch로 전송
      fetch('/reserve/save', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(ST) // 🎯 수정된 ST 객체를 전송
      })
      .then(response => {
          if (response.ok) {
              // 성공 시 (예: 마이페이지로 이동)
              alert('예약이 성공적으로 제출되었습니다. 마이페이지로 이동합니다.');
              window.location.href = '/mypage'; // 👈 성공 시 이동할 URL
          } else {
              // 서버에서 오류 응답 시
              alert('예약 제출에 실패했습니다. 입력 내용을 다시 확인해주세요.');
          }
      })
      .catch(error => {
          // 네트워크 오류 등
          console.error('Error:', error);
          alert('예약 중 오류가 발생했습니다.');
      });
    });

    // 초기 포커스
    $('#ownerName').focus();
</script>
</body>
</html>