<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>장례 예약 하기</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/Funeral_reserve.css}">
</head>

<body th:data-userseq="${sessionUserSeq}"
      th:data-mode="${mode}"
      th:data-id="${reserve != null ? reserve.id : ''}">

<!-- 헤더 -->
<div class="header-wrapper">
    <div id="header-container"></div>
</div>

<main>
    <div class="wrap">
        <div class="card">
            <div class="steps" aria-label="예약 단계">
                <div class="step-dot active" id="dot1"></div>
                <div class="step-dot" id="dot2"></div>
                <div class="step-dot" id="dot3"></div>
                <div class="step-dot" id="dot4"></div>
            </div>

            <h1 class="title" id="formTitle"
                th:text="${mode == 'edit' ? '장례 예약 수정' : '장례 예약'}">장례 예약</h1>

            <!-- STEP 1: 신청자 및 반려동물 정보 -->
            <section class="step active" id="step1">
                <div class="grid">
                    <div>
                        <label class="small">신청자명</label>
                        <div class="field">
                            <input id="ownerName" type="text" placeholder="홍길동"
                                   th:value="${reserve != null ? reserve.ownerName : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">휴대폰번호</label>
                        <div class="field">
                            <input id="ownerPhone" type="tel" inputmode="numeric" placeholder="01012345678"
                                   th:value="${reserve != null ? reserve.ownerPhone : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">이메일</label>
                        <div class="field">
                            <input id="ownerEmail" type="email" placeholder="name@example.com"
                                   th:value="${reserve != null ? reserve.ownerEmail : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">주소</label>
                        <div class="field">
                            <input id="ownerAddr" type="text" placeholder="시/구/동, 상세 주소"
                                   th:value="${reserve != null ? reserve.ownerAddr : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">반려동물 이름</label>
                        <div class="field">
                            <input id="petName" type="text" placeholder="모모"
                                   th:value="${reserve != null ? reserve.petName : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">반려동물 종류</label>
                        <div class="field">
                            <select id="petType" required>
                                <option value="">선택</option>
                                <option value="dog" th:selected="${reserve != null and reserve.petType == 'dog'}">개</option>
                                <option value="cat" th:selected="${reserve != null and reserve.petType == 'cat'}">고양이</option>
                                <option value="small" th:selected="${reserve != null and reserve.petType == 'small'}">소동물</option>
                                <option value="other" th:selected="${reserve != null and reserve.petType == 'other'}">기타</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="small">품종</label>
                        <div class="field">
                            <select id="petBreed" th:disabled="${reserve != null and reserve.petType == 'other'}">
                                <option value="">종류 선택 먼저</option>
                                <option th:each="b : ${breeds}" th:value="${b}" th:text="${b}"
                                        th:selected="${reserve != null and reserve.petBreed == b}"></option>
                            </select>
                            <input id="petBreedText" type="text" placeholder="직접 입력"
                                   th:value="${reserve != null and reserve.petType == 'other' ? reserve.petBreed : ''}"
                                   th:style="${reserve != null and reserve.petType == 'other' ? 'display:block' : 'display:none'}">
                        </div>
                        <small class="muted">※ “기타” 선택 시 품종을 직접 입력하세요.</small>
                    </div>
                    <div>
                        <label class="small">체중(kg)</label>
                        <div class="field">
                            <input id="petWeight" type="number" min="0" step="0.1" placeholder="4.2"
                                   th:value="${reserve != null ? reserve.petWeight : ''}" required>
                        </div>
                    </div>
                </div>
                <div class="actions">

                    <button id="next1" class="btn primary" type="button" disabled>다음</button>
                </div>
            </section>

            <!-- STEP 2: 장례 상세 -->
            <section class="step" id="step2">
                <div class="grid">
                    <div>
                        <label class="small">사망 일시</label>
                        <div class="field">
                            <input id="passedAt" type="datetime-local"
                                   th:value="${reserve != null ? reserve.passedAt : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">장례식장 선택</label>
                        <div class="field">
                            <select id="place" required>
                                <option value="">장례식장 선택</option>
                                <option th:selected="${reserve != null and reserve.place == '(경기 광주) 펫포레스트 경기광주점'}">(경기 광주) 펫포레스트 경기광주점</option>
                                <option th:selected="${reserve != null and reserve.place == '(대구) 대구러브펫'}">(대구) 대구러브펫</option>
                                <option th:selected="${reserve != null and reserve.place == '(부산 기장) 스타티스'}">(부산 기장) 스타티스</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="small">장례 희망일</label>
                        <div class="field">
                            <input id="funeralDate" type="date"
                                   th:value="${reserve != null ? reserve.funeralDate : ''}" required>
                        </div>
                    </div>
                    <div>
                        <label class="small">장례 유형</label>
                        <div class="field">
                            <select id="type" required>
                                <option value="">선택</option>
                                <option th:selected="${reserve != null and reserve.type == '개별 화장'}">개별 화장</option>
                                <option th:selected="${reserve != null and reserve.type == '가족 입회 화장'}">가족 입회 화장</option>
                                <option th:selected="${reserve != null and reserve.type == '합동 화장'}">합동 화장</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="small">유골 처리</label>
                        <div class="field">
                            <select id="ash" required>
                                <option value="">선택</option>
                                <option th:selected="${reserve != null and reserve.ash == '유골함 보관'}">유골함 보관</option>
                                <option th:selected="${reserve != null and reserve.ash == '추모공간 안치(제휴)'}">추모공간 안치(제휴)</option>
                                <option th:selected="${reserve != null and reserve.ash == '자연장/산골(자가)'}">자연장/산골(자가)</option>
                                <option th:selected="${reserve != null and reserve.ash == '기타(메모에 기입)'}">기타(메모에 기입)</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="small">운구(픽업)</label>
                        <div class="field">
                            <select id="pickup">
                                <option th:selected="${reserve == null or reserve.pickup == '직접 방문'}">직접 방문</option>
                                <option th:selected="${reserve != null and reserve.pickup == '운구 요청'}">운구 요청</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 운구 요청 세부 -->
                <div class="grid" id="pickupExtra"
                     th:style="${reserve != null and reserve.pickup == '운구 요청' ? 'display:grid' : 'display:none'}"
                     style="display:none; margin-top:4px">
                    <div>
                        <label class="small">운구 주소</label>
                        <div class="field">
                            <input id="pickupAddr" type="text" placeholder="도로명, 건물명 등 상세 주소"
                                   th:value="${reserve != null ? reserve.pickupAddr : ''}">
                        </div>
                    </div>
                    <div>
                        <label class="small">운구 희망 시간</label>
                        <div class="field">
                            <input id="pickupTime" type="time"
                                   th:value="${reserve != null ? reserve.pickupTime : ''}">
                        </div>
                    </div>
                </div>

                <!-- 시간 및 메모 -->
                <div class="grid-1" style="margin-top:10px">
                    <div>
                        <label class="small">희망 시간 (30분)</label>
                        <!-- 오전 / 오후 선택 -->
                        <div class="seg" style="margin-bottom:10px;">
                            <button type="button" class="seg-btn is-active" data-seg="am">오전</button>
                            <button type="button" class="seg-btn" data-seg="pm">오후</button>
                        </div>

                        <div id="timeSlots" class="slots"
                             th:data-time="${reserve != null ? reserve.time : ''}"
                             role="listbox" aria-label="시간 선택"></div>
                    </div>
                    <div>
                        <label class="small">요청사항(선택)</label>
                        <div class="field" style="align-items:start">
                            <textarea id="memo" rows="4" maxlength="300"
                                      th:text="${reserve != null ? reserve.memo : ''}"
                                      placeholder="예: 가족 입회, 이동식 수습 지원 등"></textarea>
                        </div>
                        <div class="count"><span id="memoCount">0</span>/300</div>
                    </div>
                </div>

                <div class="actions">
                    <button class="btn secondary" type="button" id="prev2">이전</button>
                    <button id="next2" class="btn primary" type="button" disabled>다음</button>
                </div>
            </section>

            <!-- STEP 3: 확인 -->
            <section class="step" id="step3">
                <div class="grid-1">
                    <div class="field" style="justify-content:center">
                        <strong>입력한 예약 내용을 확인해 주세요.</strong>
                    </div>
                    <div class="summary" id="summary"></div>
                    <label class="field" style="gap:10px">
                        <input type="checkbox" id="confirmChk" />
                        <span>입력한 내용이 정확합니다.</span>
                    </label>
                </div>
                <div class="actions">
                    <button class="btn secondary" type="button" id="prev3">이전</button>
                    <button id="next3" class="btn primary" type="button" disabled>다음</button>
                </div>
            </section>

            <!-- STEP 4: 완료 -->
            <section class="step" id="step4">
                <div class="grid-1">
                    <div class="field" style="justify-content:center">
                        <strong id="finalTitle"
                                th:text="${mode == 'edit' ? '예약 수정이 완료되었습니다.' : '예약 요청이 완료되었습니다.'}">
                            예약 요청이 완료되었습니다.
                        </strong>
                    </div>
                    <div class="summary" id="finalSummary"></div>
                </div>
                <div class="actions">
                    <button class="btn secondary" type="button" id="prev4">이전</button>
                    <button class="btn primary" id="submitBtn" type="button">제출하기</button>
                </div>
            </section>
        </div>
    </div>
</main>

<!-- 푸터 -->
<div id="footer-container"></div>

<!-- 스크립트 -->
<script src="/js/header.js"></script>
<script src="/js/footer.js"></script>
<script src="/js/funeralReserve.js"></script>

</body>
</html>
