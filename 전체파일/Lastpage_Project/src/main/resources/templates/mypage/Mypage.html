<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <link crossorigin="anonymous"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" th:href="@{/css/Mypage.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
          rel="stylesheet"/>

    <title>마이페이지</title>
</head>

<body data-bs-offset="100" data-bs-spy="scroll" data-bs-target="#list-example" tabindex="0">

<div class="list-group" id="list-example">
    <a class="list-group-item list-group-item-action" href="#Funeral-wrapper">장례서비스</a>
    <a class="list-group-item list-group-item-action" href="#Psy-counsel-wrapper">심리상담</a>
    <a class="list-group-item list-group-item-action" href="#Goods-wrapper">추모물품</a>
</div>

<div class="header-wrapper">
    <header>
        <div class="logo">
            <a href="#"><img alt="로고" src="../Asset/LastPage로고_투명.png"/></a>
        </div>
        <nav>
            <ul>
                <li><a href="#">홈</a></li>
                <li><a href="#">장례서비스</a></li>
                <li><a href="#">Ourpage</a></li>
                <li><a href="#">심리상담</a></li>
                <li><a href="#">추모굿즈</a></li>
                <li><a href="#">마이페이지</a></li>
                <li><a href="#">고객센터</a></li>
            </ul>
        </nav>
        <div class="auth">
            <a href="#">로그인</a>
            <a href="#">회원가입</a>
        </div>
    </header>

    <main>
        <div class="hello_yj">
            <div class="logo_yj">
                <img alt="" src="../Asset/LastPage로고_투명.png" style="width: 300px;"/>
            </div>
            <div class="mypage_yj">
                <p>MY PAGE</p>
                <div class="greeting_yj">
                    <span th:text="${user}">고객님</span>님,
                    <span id="timeMessage"></span>
                </div>
            </div>
        </div>

        <!-- 장례예약 -->
        <p class="subtitle_yj">장례예약</p>
        <div class="reserv_yj effect_yj" id="Funeral-wrapper">
            <div class="reserv-header_yj">
                <div class="reserv-left_yj">
                    <span class="material-symbols-outlined">calendar_month</span>
                    <p>장례예약 내역</p>
                </div>

                <div th:if="${funeralReserve != null}">
                    <a href="#" th:attr="data-id=${funeralReserve.id}" class="funeral-edit">수정</a> |
                    <a href="#" th:attr="data-id=${funeralReserve.id}" class="funeral-delete text-danger">삭제</a>
                </div>
            </div>

            <div class="reserv-content_yj">
                <div class="reserv-details_yj" th:if="${funeralReserve != null}">
                    <div><span>예약날짜</span><p th:text="${funeralReserve.date}"></p></div>
                    <div><span>예약시간</span><p th:text="${funeralReserve.time}"></p></div>
                    <div><span>예약장소</span><p th:text="${funeralReserve.location}"></p></div>
                    <div><span>요청사항</span><p th:text="${funeralReserve.memo}"></p></div>
                    <div><span>예약상태</span><button>예약완료</button></div>
                </div>

                <div class="reserv-details_yj" th:if="${funeralReserve == null}">
                    <p style="color: gray; text-align:center; margin-top:10px;">등록된 장례예약이 없습니다.</p>
                </div>
            </div>
        </div>

        <!-- 상담예약 -->
        <p class="subtitle_yj">상담예약</p>
        <div class="reserv_yj effect_yj" id="Psy-counsel-wrapper">
            <div class="reserv-header_yj">
                <div class="reserv-left_yj">
                    <span class="material-symbols-outlined">diversity_4</span>
                    <p>상담예약 내역</p>
                </div>

                <div th:if="${reserve != null}">
                    <a th:href="@{'/reserve/psy_reserve?id=' + ${reserve.id}}" class="psy-edit">수정</a> |
                    <a href="#" th:attr="data-id=${reserve.id}" class="psy-delete text-danger">삭제</a>
                </div>
            </div>

            <div class="reserv-content_yj">
                <div class="reserv-details_yj" th:if="${reserve != null}">
                    <div><span>예약자명</span><p th:text="${reserve.name}"></p></div>
                    <div><span>상담날짜</span><p th:text="${reserve.consultDate}"></p></div>
                    <div><span>상담시간</span><p th:text="${reserve.time}"></p></div>
                    <div><span>상담사</span><p th:text="${reserve.counselor}"></p></div>
                    <div><span>메모</span><p th:text="${reserve.memo}"></p></div>
                    <div><span>예약상태</span><button>예약완료</button></div>
                </div>

                <div class="reserv-details_yj" th:if="${reserve == null}">
                    <p style="color: gray; text-align:center; margin-top:10px;">등록된 상담예약이 없습니다.</p>
                </div>
            </div>
        </div>

        <!-- 굿즈 -->
        <p class="subtitle_yj">굿즈 구매내역</p>
        <div class="reserv_yj effect_yj" id="Goods-wrapper">
            <div class="reserv-header_yj">
                <div class="reserv-left_yj">
                    <span class="material-symbols-outlined">shoppingmode</span>
                    <p>구매내역</p>
                </div>
                <a href="#">구매취소 ></a>
            </div>

            <div class="reserv-content_yj">
                <div class="reserv-details_yj">
                    <p style="color: gray; text-align:center; margin-top:10px;">구매내역이 없습니다.</p>
                </div>
            </div>
        </div>
    </main>

    <footer>대충 연락처 / GitHub 주소 / 이메일 등 입력 예정.</footer>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      // 인삿말
      const hours = new Date().getHours();
      const msg = hours < 12 ? "오늘도 함께 걸어가겠습니다 ☀️"
                : hours < 18 ? "따뜻한 오후 보내세요 🌼"
                : "편안한 저녁 되세요 🌙";
      document.getElementById("timeMessage").textContent = msg;

      // 스크롤 애니메이션
      const boxes = document.querySelectorAll('.effect_yj');
      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('show');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.2 });
      boxes.forEach(effect_yj => observer.observe(effect_yj));

      /* === 상담예약 삭제 === */
      document.querySelectorAll('.psy-delete').forEach(btn => {
        btn.addEventListener('click', async e => {
          e.preventDefault();
          if (!confirm("상담 예약을 삭제하시겠습니까?")) return;
          const id = btn.dataset.id;
          const res = await fetch(`/reserve/psy_reserve/${id}`, { method: 'DELETE' });
          if (res.ok) {
            alert('상담 예약이 삭제되었습니다.');
            location.reload();
          } else {
            alert(await res.text() || '삭제 중 오류가 발생했습니다.');
          }
        });
      });

      /* === 장례예약 삭제 === */
      document.querySelectorAll('.funeral-delete').forEach(btn => {
        btn.addEventListener('click', async e => {
          e.preventDefault();
          if (!confirm("장례 예약을 삭제하시겠습니까?")) return;
          const id = btn.dataset.id;
          const res = await fetch(`/reserve/funeral_reserve/${id}`, { method: 'DELETE' });
          if (res.ok) {
            alert('장례 예약이 삭제되었습니다.');
            location.reload();
          } else {
            alert(await res.text() || '삭제 중 오류가 발생했습니다.');
          }
        });
      });
    });
</script>
</body>
</html>
