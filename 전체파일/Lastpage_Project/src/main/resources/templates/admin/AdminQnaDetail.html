<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>QnA 상세 관리</title>

    <style>
        body { background:#f1f2f6; font-family:'Apple SD Gothic Neo', sans-serif; }

        .container {
            width: 900px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.12);
        }

        h2 { margin-bottom: 20px; }

        .field-title { font-weight: bold; margin-top: 20px; color:#2d3436; }

        .content-box {
             background: #f1f2f6;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            white-space: pre-line;
        }

        .badge-secret {
            padding: 4px 10px;
            background: #ffeaa7;
            border-radius: 8px;
            font-size: 13px;
            color: #d35400;
            margin-left: 10px;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .btn {
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }

        .btn-primary { background:#0984e3; color:white; }
        .btn-danger { background:#d63031; color:white; }
        .btn-secondary { background:#636e72; color:white; }

        .img-preview {
            width: 120px;
            margin-right: 10px;
            border-radius: 8px;
        }
    </style>
</head>

<body>

<div class="container">
    <h2>문의 상세</h2>

    <div>
        <span class="field-title">제목</span>
        <div>
            <span th:text="${qna.title}"></span>
            <span th:if="${qna.secret}" class="badge-secret">비공개</span>
        </div>

        <span class="field-title">작성자</span>
        <div th:text="${qna.nickname != null ? qna.nickname : '익명'}"></div>

        <span class="field-title">카테고리</span>
        <div th:text="${qna.category}"></div>

        <span class="field-title">작성일</span>
        <div th:text="${#temporals.format(qna.createdAt, 'yyyy-MM-dd HH:mm')}"></div>

        <span class="field-title">내용</span>
        <div class="content-box" th:text="${qna.content}"></div>

        <!-- 이미지 -->
        <span class="field-title" th:if="${qna.images != null and !qna.images.isEmpty()}">첨부 이미지</span>
        <div th:each="img : ${qna.images}">
            <img th:src="@{${img}}" class="img-preview"/>
        </div>

        <!-- 링크 -->
        <span class="field-title" th:if="${qna.links != null and !qna.links.isEmpty()}">첨부 링크</span>
        <ul th:each="link : ${qna.links}">
            <li><a th:href="@{${link}}" target="_blank" th:text="${link}"></a></li>
        </ul>
    </div>

    <hr/>

    <!-- 관리자 답변 -->
    <h3>관리자 답변</h3>
    <input type="hidden" id="qnaId" th:value="${qna.id}"/>

    <textarea id="adminAnswer"
              th:text="${qna.adminAnswer != null ? qna.adminAnswer : ''}"
              placeholder="답변을 입력하세요"></textarea>

    <div style="margin-top:20px;">
        <button class="btn btn-primary" onclick="saveAnswer()">저장하기</button>
        <button class="btn btn-danger" th:if="${qna.adminAnswer != null}" onclick="deleteAnswer()">답변 삭제</button>
        <a href="/admin/qna" class="btn btn-secondary">목록으로</a>
    </div>
</div>


<script>
    function saveAnswer() {
        const id = document.getElementById("qnaId").value;
        const answer = document.getElementById("adminAnswer").value;

        fetch("/admin/qna/api/answer", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                qnaId: id,
                answer: answer,
                adminName: "관리자"
            })
        }).then(res => res.json())
            .then(() => {
                alert("답변이 저장되었습니다.");
                location.reload();
            });
    }

    function deleteAnswer() {
        const id = document.getElementById("qnaId").value;

        fetch("/admin/qna/api/answer/delete/" + id, {
            method: "DELETE"
        }).then(() => {
            alert("답변이 삭제되었습니다.");
            location.reload();
        });
    }
</script>

</body>
</html>
